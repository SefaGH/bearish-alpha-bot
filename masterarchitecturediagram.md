ğŸ¨ **Bearish Alpha Bot - Comprehensive Architecture & Flow Diagrams**

---

## ğŸ“Š **MASTER ARCHITECTURE DIAGRAM**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     BEARISH ALPHA TRADING BOT                                â•‘
â•‘                          Production v1.0                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ENTRY POINT: main.py                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Load Configuration (config/config.yaml)                            â”‚ â”‚
â”‚  â”‚  2. Initialize Logging System                                          â”‚ â”‚
â”‚  â”‚  3. Print Startup Banner (with headers)                                â”‚ â”‚
â”‚  â”‚  4. Create LiveTradingEngine instance                                  â”‚ â”‚
â”‚  â”‚  5. Run engine: await engine.run()                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CORE ENGINE: LiveTradingEngine                             â”‚
â”‚                   (src/core/live_trading_engine.py)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ INITIALIZATION (__init__)                                              â”‚ â”‚
â”‚  â”‚ â€¢ Load config, set paper_mode                                          â”‚ â”‚
â”‚  â”‚ â€¢ Initialize components:                                               â”‚ â”‚
â”‚  â”‚   - ExchangeManager (Bybit API)                                        â”‚ â”‚
â”‚  â”‚   - PortfolioManager (capital tracking)                                â”‚ â”‚
â”‚  â”‚   - RiskManager (position sizing)                                      â”‚ â”‚
â”‚  â”‚   - SignalGenerator (strategy logic)                                   â”‚ â”‚
â”‚  â”‚   - AdvancedPositionManager (exit management)                          â”‚ â”‚
â”‚  â”‚   - WebSocketManager (real-time data)                                  â”‚ â”‚
â”‚  â”‚ â€¢ Setup statistics: ws_stats, ws_config                                â”‚ â”‚
â”‚  â”‚ â€¢ State: STOPPED                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MAIN RUN METHOD (run())                                                â”‚ â”‚
â”‚  â”‚  1. State â†’ STARTING                                                   â”‚ â”‚
â”‚  â”‚  2. Log startup message with headers                                   â”‚ â”‚
â”‚  â”‚  3. Start WebSocket streams (OHLCV for all symbols/timeframes)         â”‚ â”‚
â”‚  â”‚  4. Start position monitoring loop (background task)                   â”‚ â”‚
â”‚  â”‚  5. Start strategy execution loop (main task)                          â”‚ â”‚
â”‚  â”‚  6. State â†’ RUNNING                                                    â”‚ â”‚
â”‚  â”‚  7. Wait for shutdown signal                                           â”‚ â”‚
â”‚  â”‚  8. State â†’ STOPPING â†’ STOPPED                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                           â”‚                           â”‚
         â”‚                           â”‚                           â”‚
         â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebSocket Loop  â”‚    â”‚  Strategy Loop       â”‚    â”‚  Position Monitor    â”‚
â”‚  (Background)    â”‚    â”‚  (Main Loop)         â”‚    â”‚  (Background)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ **DETAILED FLOW DIAGRAMS**

### **1. WEBSOCKET DATA FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     WebSocket Manager (src/core/websocket_manager.py)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    START
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ start_ohlcv_stream(symbol, tf)     â”‚
â”‚ â€¢ Connect to Bybit WebSocket        â”‚
â”‚ â€¢ Subscribe to kline.<interval>     â”‚
â”‚ â€¢ Register callback handler         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Message Received (Callback)         â”‚
â”‚ â€¢ Parse kline data                  â”‚
â”‚ â€¢ Convert to OHLCV format           â”‚
â”‚ â€¢ Store in self.data_cache          â”‚
â”‚ â€¢ Increment message_count           â”‚
â”‚ â€¢ Update last_message_time          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA CACHE STRUCTURE                â”‚
â”‚ {                                   â”‚
â”‚   "BTC/USDT:USDT": {                â”‚
â”‚     "1m": {                         â”‚
â”‚       "ohlcv": [                    â”‚
â”‚         [timestamp, o, h, l, c, v], â”‚
â”‚         [timestamp, o, h, l, c, v], â”‚
â”‚         ...                         â”‚
â”‚       ],                            â”‚
â”‚       "symbol": "BTC/USDT:USDT",    â”‚
â”‚       "timeframe": "1m"             â”‚
â”‚     }                               â”‚
â”‚   }                                 â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEALTH MONITORING                   â”‚
â”‚ â€¢ get_connection_health()           â”‚
â”‚   - status: healthy/warming_up/     â”‚
â”‚     connecting/disconnected         â”‚
â”‚   - active_streams: count           â”‚
â”‚   - total_messages: count           â”‚
â”‚   - uptime_seconds: duration        â”‚
â”‚                                     â”‚
â”‚ â€¢ is_data_fresh(symbol, tf)         â”‚
â”‚   - Check last candle age           â”‚
â”‚   - Return True if < 60s            â”‚
â”‚                                     â”‚
â”‚ â€¢ get_data_quality_score()          â”‚
â”‚   - Freshness: 40 pts               â”‚
â”‚   - Completeness: 30 pts            â”‚
â”‚   - Update frequency: 30 pts        â”‚
â”‚   - Total: 0-100                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_latest_data(symbol, tf)         â”‚
â”‚ â€¢ Return cached OHLCV data          â”‚
â”‚ â€¢ Used by strategy loop             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **2. STRATEGY EXECUTION FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Strategy Execution Loop (_strategy_execution_loop)           â”‚
â”‚                     Interval: 5 seconds (configurable)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    LOOP START (Every 5s)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR each symbol in active_symbols:                          â”‚
â”‚   FOR each timeframe in active_timeframes:                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Fetch OHLCV Data (WITH WEBSOCKET PRIORITY)         â”‚
â”‚ _get_ohlcv_with_priority(symbol, timeframe, limit=100)     â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ TRY WEBSOCKET FIRST:                                â”‚   â”‚
â”‚ â”‚ â€¢ Check ws_config['priority_enabled']               â”‚   â”‚
â”‚ â”‚ â€¢ Call ws_manager.is_data_fresh(symbol, tf, 60s)    â”‚   â”‚
â”‚ â”‚ â€¢ If fresh:                                         â”‚   â”‚
â”‚ â”‚   - Get ws_manager.get_latest_data()                â”‚   â”‚
â”‚ â”‚   - Validate len(ohlcv) >= limit                    â”‚   â”‚
â”‚ â”‚   - Record latency (ms)                             â”‚   â”‚
â”‚ â”‚   - _record_ws_fetch(latency, success=True)         â”‚   â”‚
â”‚ â”‚   - Log: ğŸ“¡ [WS-DATA] symbol tf - X candles, Yms    â”‚   â”‚
â”‚ â”‚   - Return DataFrame                                â”‚   â”‚
â”‚ â”‚ â€¢ If fails: _record_ws_fetch(0, success=False)      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ FALLBACK TO REST:                                   â”‚   â”‚
â”‚ â”‚ â€¢ _fetch_ohlcv_rest(symbol, tf, limit, start_time)  â”‚   â”‚
â”‚ â”‚ â€¢ For each exchange_client:                         â”‚   â”‚
â”‚ â”‚   - Try fetch_ohlcv()                               â”‚   â”‚
â”‚ â”‚   - Record latency                                  â”‚   â”‚
â”‚ â”‚   - _record_rest_fetch(latency, success=True)       â”‚   â”‚
â”‚ â”‚   - Log: ğŸŒ [REST-SUCCESS] symbol - Xms             â”‚   â”‚
â”‚ â”‚   - Return DataFrame                                â”‚   â”‚
â”‚ â”‚ â€¢ If all fail: return None                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Check Data Validity                                â”‚
â”‚ if ohlcv_df is None or ohlcv_df.empty:                     â”‚
â”‚   log warning, continue to next symbol                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Calculate Indicators                               â”‚
â”‚ signal_generator.calculate_indicators(ohlcv_df)            â”‚
â”‚ â€¢ EMA calculations                                         â”‚
â”‚ â€¢ Volume analysis                                          â”‚
â”‚ â€¢ Price action patterns                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Generate Signal                                    â”‚
â”‚ signal = signal_generator.generate_signal(                 â”‚
â”‚   symbol, timeframe, ohlcv_df                              â”‚
â”‚ )                                                           â”‚
â”‚                                                             â”‚
â”‚ Signal Structure:                                           â”‚
â”‚ {                                                           â”‚
â”‚   'action': 'long' | 'short' | None,                       â”‚
â”‚   'symbol': 'BTC/USDT:USDT',                               â”‚
â”‚   'timeframe': '15m',                                      â”‚
â”‚   'entry_price': 50000.00,                                 â”‚
â”‚   'stop_loss': 49000.00,                                   â”‚
â”‚   'take_profit': 55000.00,                                 â”‚
â”‚   'confidence': 0.85,                                      â”‚
â”‚   'timestamp': 1729425147000                               â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Check Signal Validity                              â”‚
â”‚ if signal is None or signal['action'] is None:             â”‚
â”‚   continue to next                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: DUPLICATE PREVENTION CHECK (NEW!)                  â”‚
â”‚ position_manager.is_duplicate_signal(signal)               â”‚
â”‚                                                             â”‚
â”‚ Checks:                                                     â”‚
â”‚ â€¢ Recent signals cache (last 5 minutes)                    â”‚
â”‚ â€¢ Same symbol, side, timeframe                             â”‚
â”‚ â€¢ Entry price within 0.1% tolerance                        â”‚
â”‚                                                             â”‚
â”‚ if is_duplicate:                                            â”‚
â”‚   log: âš ï¸ [DUPLICATE-SIGNAL] Ignoring...                   â”‚
â”‚   continue to next                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: PORTFOLIO CAPITAL CHECK (NEW!)                     â”‚
â”‚ portfolio_manager.check_capital_limit()                    â”‚
â”‚                                                             â”‚
â”‚ â€¢ Get total_capital_used from active positions             â”‚
â”‚ â€¢ Check if total_capital_used >= max_capital              â”‚
â”‚                                                             â”‚
â”‚ if capital_limit_reached:                                  â”‚
â”‚   log: ğŸ’° [CAPITAL-LIMIT] Cannot open new position        â”‚
â”‚   continue to next                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Risk Management & Position Sizing                  â”‚
â”‚ position_size = risk_manager.calculate_position_size(      â”‚
â”‚   signal, current_balance                                  â”‚
â”‚ )                                                           â”‚
â”‚                                                             â”‚
â”‚ Calculations:                                               â”‚
â”‚ â€¢ Risk per trade: 1% of balance                            â”‚
â”‚ â€¢ Risk amount = balance * 0.01                             â”‚
â”‚ â€¢ Price distance = |entry - stop_loss|                     â”‚
â”‚ â€¢ Position size = risk_amount / price_distance             â”‚
â”‚ â€¢ Apply min/max limits                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: Execute Trade                                      â”‚
â”‚ if paper_mode:                                             â”‚
â”‚   â€¢ Simulate order execution                               â”‚
â”‚   â€¢ Record to paper trading ledger                         â”‚
â”‚ else:                                                       â”‚
â”‚   â€¢ Place real order via exchange API                      â”‚
â”‚                                                             â”‚
â”‚ Create position record:                                    â”‚
â”‚ {                                                           â”‚
â”‚   'position_id': 'pos_123abc',                             â”‚
â”‚   'symbol': 'BTC/USDT:USDT',                               â”‚
â”‚   'side': 'long',                                          â”‚
â”‚   'entry_price': 50000.00,                                 â”‚
â”‚   'current_price': 50000.00,                               â”‚
â”‚   'amount': 0.01,                                          â”‚
â”‚   'stop_loss': 49000.00,                                   â”‚
â”‚   'take_profit': 55000.00,                                 â”‚
â”‚   'entry_time': timestamp,                                 â”‚
â”‚   'status': 'open'                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 10: Register Position                                 â”‚
â”‚ position_manager.add_position(position)                    â”‚
â”‚ â€¢ Add to active_positions dict                             â”‚
â”‚ â€¢ Add signal to recent_signals cache                       â”‚
â”‚ â€¢ Start monitoring for this position                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
    NEXT SYMBOL/TIMEFRAME
      â”‚
      â–¼
    SLEEP (5 seconds)
      â”‚
      â–¼
    LOOP AGAIN
```

---

### **3. POSITION MONITORING FLOW**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Position Monitoring Loop (_position_monitoring_loop)             â”‚
â”‚                     Interval: 10 seconds (configurable)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    LOOP START (Every 10s)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get Active Positions                                        â”‚
â”‚ positions = position_manager.get_active_positions()        â”‚
â”‚                                                             â”‚
â”‚ if no positions:                                            â”‚
â”‚   log: "No active positions to monitor"                    â”‚
â”‚   sleep 10s, continue                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initialize Loop Variables                                   â”‚
â”‚ â€¢ total_unrealized_pnl = 0.0                               â”‚
â”‚ â€¢ positions_closed_count = 0                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOR each position in active_positions:                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Get Current Price (WEBSOCKET PRIORITY)             â”‚
â”‚ current_price = _get_current_price(symbol)                 â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ TRY WEBSOCKET:                                    â”‚     â”‚
â”‚ â”‚ â€¢ Get ws_manager.get_latest_data(symbol, '1m')    â”‚     â”‚
â”‚ â”‚ â€¢ Extract last close price                        â”‚     â”‚
â”‚ â”‚ â€¢ If available: return price                      â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ FALLBACK TO REST:                                 â”‚     â”‚
â”‚ â”‚ â€¢ Fetch ticker from exchange                      â”‚     â”‚
â”‚ â”‚ â€¢ Return last price                               â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Update Position Price                              â”‚
â”‚ position['current_price'] = current_price                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Calculate P&L                                      â”‚
â”‚ entry_price = position['entry_price']                      â”‚
â”‚ amount = position['amount']                                â”‚
â”‚ side = position['side']                                    â”‚
â”‚                                                             â”‚
â”‚ if side == 'long':                                         â”‚
â”‚   unrealized_pnl = (current - entry) * amount              â”‚
â”‚ else: # short                                              â”‚
â”‚   unrealized_pnl = (entry - current) * amount              â”‚
â”‚                                                             â”‚
â”‚ pnl_pct = (unrealized_pnl / (entry * amount)) * 100       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Enhanced P&L Logging (NEW!)                        â”‚
â”‚ logger.info(                                                â”‚
â”‚   f"ğŸ’° [P&L-UPDATE] {position_id}\n"                       â”‚
â”‚   f"   Symbol: {symbol}\n"                                 â”‚
â”‚   f"   Entry: ${entry_price:.2f}\n"                        â”‚
â”‚   f"   Current: ${current_price:.2f}\n"                    â”‚
â”‚   f"   Unrealized P&L: ${unrealized_pnl:.2f}               â”‚
â”‚      ({pnl_pct:+.2f}%)"                                    â”‚
â”‚ )                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Check Exit Conditions                              â”‚
â”‚ exit_check = position_manager.manage_position_exits(       â”‚
â”‚   position_id                                              â”‚
â”‚ )                                                           â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Exit Conditions Checked:                          â”‚     â”‚
â”‚ â”‚                                                    â”‚     â”‚
â”‚ â”‚ 1. STOP LOSS:                                     â”‚     â”‚
â”‚ â”‚    â€¢ Long: current_price <= stop_loss             â”‚     â”‚
â”‚ â”‚    â€¢ Short: current_price >= stop_loss            â”‚     â”‚
â”‚ â”‚    â€¢ Log: ğŸ›‘ [STOP-LOSS-HIT]                      â”‚     â”‚
â”‚ â”‚                                                    â”‚     â”‚
â”‚ â”‚ 2. TAKE PROFIT:                                   â”‚     â”‚
â”‚ â”‚    â€¢ Long: current_price >= take_profit           â”‚     â”‚
â”‚ â”‚    â€¢ Short: current_price <= take_profit          â”‚     â”‚
â”‚ â”‚    â€¢ Log: ğŸ¯ [TAKE-PROFIT-HIT]                    â”‚     â”‚
â”‚ â”‚                                                    â”‚     â”‚
â”‚ â”‚ 3. TRAILING STOP (NEW!):                          â”‚     â”‚
â”‚ â”‚    â€¢ Track highest_price (long) / lowest (short)  â”‚     â”‚
â”‚ â”‚    â€¢ Calculate trailing_stop_level                â”‚     â”‚
â”‚ â”‚    â€¢ Exit if pullback exceeds distance            â”‚     â”‚
â”‚ â”‚    â€¢ Log: ğŸ“‰ [TRAILING-STOP-HIT]                  â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚ Returns:                                                    â”‚
â”‚ {                                                           â”‚
â”‚   'should_exit': True/False,                               â”‚
â”‚   'exit_reason': 'stop_loss'|'take_profit'|                â”‚
â”‚                  'trailing_stop',                          â”‚
â”‚   'exit_price': current_price                              â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Handle Exit if Triggered                           â”‚
â”‚ if exit_check['should_exit']:                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Log Enhanced Exit (NEW!):                       â”‚     â”‚
â”‚   â”‚ exit_emoji = ğŸ›‘ if SL else ğŸ¯                   â”‚     â”‚
â”‚   â”‚ logger.warning(                                 â”‚     â”‚
â”‚   â”‚   f"{exit_emoji} [EXIT-SIGNAL] {pos_id}\n"     â”‚     â”‚
â”‚   â”‚   f"   Symbol: {symbol}\n"                      â”‚     â”‚
â”‚   â”‚   f"   Reason: {exit_reason}\n"                 â”‚     â”‚
â”‚   â”‚   f"   Entry: ${entry:.2f}\n"                   â”‚     â”‚
â”‚   â”‚   f"   Exit: ${current:.2f}\n"                  â”‚     â”‚
â”‚   â”‚   f"   P&L: ${pnl:.2f} ({pct:+.2f}%)"          â”‚     â”‚
â”‚   â”‚ )                                               â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Execute Exit:                                   â”‚     â”‚
â”‚   â”‚ â€¢ Close position (API or paper)                 â”‚     â”‚
â”‚   â”‚ â€¢ Remove from active_positions                  â”‚     â”‚
â”‚   â”‚ â€¢ Update portfolio                              â”‚     â”‚
â”‚   â”‚ â€¢ Increment positions_closed_count              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: Accumulate Total P&L                               â”‚
â”‚ total_unrealized_pnl += unrealized_pnl                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
    NEXT POSITION
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Summary Logging (NEW!)                             â”‚
â”‚ if active_positions:                                        â”‚
â”‚   logger.info(                                              â”‚
â”‚     f"ğŸ“Š [MONITORING-SUMMARY]\n"                           â”‚
â”‚     f"   Active Positions: {len(active_positions)}\n"      â”‚
â”‚     f"   Total Unrealized P&L: ${total_pnl:.2f}\n"        â”‚
â”‚     f"   Positions Closed: {positions_closed_count}"       â”‚
â”‚   )                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
    SLEEP (10 seconds)
      â”‚
      â–¼
    LOOP AGAIN
```

---

## ğŸ“ **FILE STRUCTURE & RESPONSIBILITIES**

```
bearish-alpha-bot/
â”‚
â”œâ”€â”€ main.py â­ ENTRY POINT
â”‚   â”œâ”€â”€ Load config/config.yaml
â”‚   â”œâ”€â”€ Initialize logging
â”‚   â”œâ”€â”€ Print startup banner (with headers) ğŸ†•
â”‚   â”œâ”€â”€ Create LiveTradingEngine
â”‚   â””â”€â”€ Run engine
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.yaml                    # Main configuration
â”‚   â””â”€â”€ config.example.yaml ğŸ†•         # With WebSocket settings
â”‚       â”œâ”€â”€ exchange settings
â”‚       â”œâ”€â”€ trading parameters
â”‚       â”œâ”€â”€ risk management
â”‚       â”œâ”€â”€ portfolio limits ğŸ†•
â”‚       â””â”€â”€ websocket settings ğŸ†•
â”‚           â”œâ”€â”€ priority_enabled: true
â”‚           â”œâ”€â”€ max_data_age: 60
â”‚           â””â”€â”€ fallback_threshold: 3
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ live_trading_engine.py â­ CORE ENGINE
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: LiveTradingEngine
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Load config
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Initialize all managers
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Setup ws_config ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Setup ws_stats ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ run() - Main entry
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Log startup headers ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Start WebSocket streams
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Start position monitoring
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Start strategy execution
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _strategy_execution_loop() ğŸ”„
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ For each symbol/timeframe:
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _get_ohlcv_with_priority() ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate indicators
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Generate signal
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check duplicate ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check capital limit ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Risk management
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Execute trade
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _position_monitoring_loop() ğŸ”„
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ For each active position:
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Get current price (WS priority)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate P&L
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Enhanced logging ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check exit conditions
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Summary stats ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• _get_ohlcv_with_priority()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Try WebSocket first
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check is_data_fresh()
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Get cached data
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Record metrics
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return DataFrame
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Fallback to REST
â”‚   â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ _fetch_ohlcv_rest()
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Record metrics
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• _fetch_ohlcv_rest()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ For each exchange client
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Try fetch_ohlcv()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Record latency
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return DataFrame
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• _record_ws_fetch()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Update ws_stats
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate avg latency
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Calculate success rate
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• _record_rest_fetch()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Update rest stats
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Calculate avg latency
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• get_websocket_stats()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Return ws_stats copy
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Add connection_health
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate usage_ratio
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Calculate latency_improvement
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ shutdown()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Stop all loops
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Close positions
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Disconnect
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ websocket_manager.py ğŸ”Œ REAL-TIME DATA
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: WebSocketManager
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Initialize ccxt.pro exchange
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Setup data_cache
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Setup streams dict
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• Setup health tracking
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ start_time
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message_count
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ last_message_time
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ reconnection_count
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ start_ohlcv_stream()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Connect WebSocket
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Subscribe to kline
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Register callback
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Start listening
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _handle_ohlcv_message()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Parse kline data
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Convert to OHLCV
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Update cache
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Increment message_count ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Update last_message_time ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get_latest_data()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Lookup cache by symbol/tf
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return OHLCV data
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• get_connection_health()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate uptime
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Determine status
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ disconnected (no streams)
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ connecting (0 messages)
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ warming_up (<10 messages)
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ healthy (>=10 messages)
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return health dict
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• is_data_fresh()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Get latest data
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check last candle timestamp
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate age in seconds
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return age < max_age_seconds
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• get_data_quality_score()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Freshness score (40%)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Completeness score (30%)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Update frequency score (30%)
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return total score (0-100)
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ stop_all_streams()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Disconnect all WebSockets
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Clear cache
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ position_manager.py ğŸ“Š POSITION MANAGEMENT
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: AdvancedPositionManager
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Initialize positions dict
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Initialize recent_signals list ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Set signal_expiry_minutes ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ add_position()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Generate position_id
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Store in positions dict
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Add to recent_signals ğŸ†•
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Log creation
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• is_duplicate_signal()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Clean expired signals
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ For each recent signal:
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check symbol match
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check side match
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check timeframe match
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Check entry price (Â±0.1%)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ If duplicate found:
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Log warning
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return True/False
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ manage_position_exits()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Get position data
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check STOP LOSS
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Long: current <= SL
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Short: current >= SL
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ†• Enhanced logging
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check TAKE PROFIT
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Long: current >= TP
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Short: current <= TP
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ†• Enhanced logging
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• Check TRAILING STOP
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Track highest_price (long)
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Track lowest_price (short)
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate trailing_stop_level
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check if triggered
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Log trailing stop hit
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return exit_check dict
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get_active_positions()
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return positions.values()
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ close_position()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Remove from positions
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Log closure
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ portfolio_manager.py ğŸ’° PORTFOLIO TRACKING
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: PortfolioManager
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Set initial_balance
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Set current_balance
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• Set max_capital_pct (80%)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• Calculate max_capital
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Initialize positions tracking
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ†• check_capital_limit()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sum capital_used from positions
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Calculate total_capital_used
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Check vs max_capital
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ If exceeded:
â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Log capital limit warning
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return can_open_position
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ update_balance()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Add/subtract from balance
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Log update
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ get_available_balance()
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return current_balance
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ get_portfolio_summary()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Total value
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Total P&L
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ†• Capital utilization
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Position count
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ risk_manager.py âš ï¸ RISK MANAGEMENT
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: RiskManager
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Set risk_per_trade (1%)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Set max_position_size
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Set min_position_size
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ calculate_position_size()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ risk_amount = balance * 0.01
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ price_distance = |entry - SL|
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ position_size = risk / distance
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Apply min/max limits
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Return size
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ validate_trade()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Check position size
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Check risk/reward ratio
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Return valid/invalid
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ signal_generator.py ğŸ“ˆ STRATEGY LOGIC
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ CLASS: SignalGenerator
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ calculate_indicators()
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ EMA calculations
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Volume analysis
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Price patterns
â”‚   â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ generate_signal()
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Analyze indicators
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Identify entry conditions
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ Calculate SL/TP levels
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ Return signal dict
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ exchange_manager.py ğŸ”Œ EXCHANGE API
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ CLASS: ExchangeManager
â”‚   â”‚       â”‚   â”œâ”€â”€ __init__()
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Load API credentials
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Initialize ccxt exchange
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ Set testnet if paper_mode
â”‚   â”‚       â”‚   â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ fetch_ohlcv()
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Call exchange.fetch_ohlcv()
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ Return data
â”‚   â”‚       â”‚   â”‚
â”‚   â”‚       â”‚   â”œâ”€â”€ place_order()
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Create order params
â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ Submit to exchange
â”‚   â”‚       â”‚   â”‚   â””â”€â”€ Return order result
â”‚   â”‚       â”‚   â”‚
â”‚   â”‚       â”‚   â””â”€â”€ get_account_balance()
â”‚   â”‚       â”‚       â”œâ”€â”€ Fetch from exchange
â”‚   â”‚       â”‚       â””â”€â”€ Return balance
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.py ğŸ“ LOGGING SYSTEM
â”‚       â”‚   â”œâ”€â”€ Setup logging config
â”‚       â”‚   â”œâ”€â”€ Console handler
â”‚       â”‚   â”œâ”€â”€ File handler
â”‚       â”‚   â””â”€â”€ ğŸ†• Startup headers formatter
â”‚       â”‚
â”‚       â””â”€â”€ helpers.py ğŸ› ï¸ UTILITY FUNCTIONS
â”‚           â”œâ”€â”€ Format price
â”‚           â”œâ”€â”€ Calculate percentage
â”‚           â””â”€â”€ Time conversions
â”‚
â”œâ”€â”€ tests/ ğŸ§ª TEST SUITE
â”‚   â”œâ”€â”€ test_position_exit_simple.py
â”‚   â”‚   â”œâ”€â”€ test_stop_loss_trigger
â”‚   â”‚   â”œâ”€â”€ test_take_profit_trigger
â”‚   â”‚   â””â”€â”€ test_basic_monitoring
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ†• test_position_monitoring_phase2.py
â”‚   â”‚   â”œâ”€â”€ test_short_position_stop_loss
â”‚   â”‚   â””â”€â”€ test_trailing_stop_activation
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ†• test_websocket_integration_full.py
â”‚       â”œâ”€â”€ test_websocket_priority_when_available
â”‚       â”œâ”€â”€ test_rest_fallback_when_unavailable
â”‚       â”œâ”€â”€ test_statistics_tracking
â”‚       â”œâ”€â”€ test_data_freshness_check
â”‚       â”œâ”€â”€ test_connection_health_monitoring
â”‚       â”œâ”€â”€ test_connection_health_disconnected
â”‚       â””â”€â”€ test_data_quality_score
â”‚
â”œâ”€â”€ logs/ ğŸ“ LOG FILES
â”‚   â”œâ”€â”€ trading_YYYY-MM-DD.log
â”‚   â””â”€â”€ error_YYYY-MM-DD.log
â”‚
â””â”€â”€ data/ ğŸ“Š DATA STORAGE
    â”œâ”€â”€ positions.json
    â”œâ”€â”€ signals.json
    â””â”€â”€ portfolio.json
```

---

## ğŸ”„ **DATA FLOW DIAGRAM**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW ARCHITECTURE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Bybit Exchange    â”‚
                        â”‚   (WebSocket API)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Real-time
                                  â”‚ kline data
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  WebSocketManager   â”‚
                        â”‚  â€¢ Receive messages â”‚
                        â”‚  â€¢ Parse data       â”‚
                        â”‚  â€¢ Cache OHLCV      â”‚
                        â”‚  â€¢ Track health ğŸ†•  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Strategy Loop    â”‚      â”‚ Monitoring Loop  â”‚
          â”‚ (Every 5s)       â”‚      â”‚ (Every 10s)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â”‚
                    â”‚ WS Priority ğŸ†•            â”‚ WS Priority
                    â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Get OHLCV Data   â”‚      â”‚ Get Current Priceâ”‚
          â”‚ â€¢ Try WS first   â”‚      â”‚ â€¢ Try WS first   â”‚
          â”‚ â€¢ Fallback REST  â”‚      â”‚ â€¢ Fallback REST  â”‚
          â”‚ â€¢ Record metrics â”‚      â”‚ â€¢ Update positionâ”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â”‚
                    â–¼                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ SignalGenerator  â”‚      â”‚ Calculate P&L    â”‚
          â”‚ â€¢ Calculate EMA  â”‚      â”‚ â€¢ Track profit   â”‚
          â”‚ â€¢ Volume check   â”‚      â”‚ â€¢ Enhanced log ğŸ†•â”‚
          â”‚ â€¢ Pattern detect â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                           â–¼
                    â–¼                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ Exit Manager     â”‚
          â”‚ Generate Signal  â”‚         â”‚ â€¢ Check SL/TP    â”‚
          â”‚ {action, price,  â”‚         â”‚ â€¢ Trailing stopğŸ†•â”‚
          â”‚  SL, TP}         â”‚         â”‚ â€¢ Execute exit   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                           â”‚
                    â–¼                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
          â”‚ Duplicate CheckğŸ†•â”‚                  â”‚
          â”‚ â€¢ Recent signals â”‚                  â”‚
          â”‚ â€¢ 5 min expiry   â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                           â”‚
                    â–¼                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
          â”‚ Capital Check ğŸ†• â”‚                  â”‚
          â”‚ â€¢ 80% max limit  â”‚                  â”‚
          â”‚ â€¢ Available cap  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                           â”‚
                    â–¼                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
          â”‚ RiskManager      â”‚                  â”‚
          â”‚ â€¢ 1% risk/trade  â”‚                  â”‚
          â”‚ â€¢ Position size  â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                           â”‚
                    â–¼                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
          â”‚ Execute Trade    â”‚                  â”‚
          â”‚ â€¢ Paper/Live     â”‚                  â”‚
          â”‚ â€¢ Create positionâ”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                    â”‚                           â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ PositionManager  â”‚
          â”‚ â€¢ Active positionsâ”‚
          â”‚ â€¢ Track signals ğŸ†•â”‚
          â”‚ â€¢ Monitor exits  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ PortfolioManager â”‚
          â”‚ â€¢ Update balance â”‚
          â”‚ â€¢ Track capitalğŸ†•â”‚
          â”‚ â€¢ Calculate P&L  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š **STATISTICS & MONITORING**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONITORING DASHBOARD (Conceptual)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEBSOCKET STATISTICS (get_websocket_stats()) ğŸ†•                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Connection Health:                                                       â”‚
â”‚   â€¢ Status: healthy                                                      â”‚
â”‚   â€¢ Active Streams: 4                                                    â”‚
â”‚   â€¢ Total Messages: 1,247                                                â”‚
â”‚   â€¢ Uptime: 2h 34m                                                       â”‚
â”‚   â€¢ Reconnections: 0                                                     â”‚
â”‚                                                                          â”‚
â”‚ Data Fetching:                                                           â”‚
â”‚   â€¢ WebSocket Fetches: 523                                               â”‚
â”‚   â€¢ REST Fetches: 12                                                     â”‚
â”‚   â€¢ WebSocket Usage Ratio: 97.8%                                         â”‚
â”‚   â€¢ WebSocket Success Rate: 99.2%                                        â”‚
â”‚                                                                          â”‚
â”‚ Performance:                                                             â”‚
â”‚   â€¢ Avg Latency (WS): 18.3ms                                             â”‚
â”‚   â€¢ Avg Latency (REST): 234.7ms                                          â”‚
â”‚   â€¢ Latency Improvement: 92.2%                                           â”‚
â”‚                                                                          â”‚
â”‚ Data Quality (per symbol):                                               â”‚
â”‚   â€¢ BTC/USDT:USDT 1m: 95/100                                             â”‚
â”‚   â€¢ ETH/USDT:USDT 1m: 92/100                                             â”‚
â”‚   â€¢ SOL/USDT:USDT 5m: 88/100                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PORTFOLIO STATISTICS ğŸ†•                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Capital Management:                                                      â”‚
â”‚   â€¢ Initial Balance: $10,000.00                                          â”‚
â”‚   â€¢ Current Balance: $10,245.50                                          â”‚
â”‚   â€¢ Total P&L: +$245.50 (+2.45%)                                         â”‚
â”‚                                                                          â”‚
â”‚ Capital Utilization:                                                     â”‚
â”‚   â€¢ Max Capital: $8,000.00 (80% limit)                                   â”‚
â”‚   â€¢ Used Capital: $5,200.00                                              â”‚
â”‚   â€¢ Available: $2,800.00                                                 â”‚
â”‚   â€¢ Utilization: 65%                                                     â”‚
â”‚                                                                          â”‚
â”‚ Positions:                                                               â”‚
â”‚   â€¢ Active: 3                                                            â”‚
â”‚   â€¢ Total Opened: 47                                                     â”‚
â”‚   â€¢ Total Closed: 44                                                     â”‚
â”‚   â€¢ Win Rate: 63.6%                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTIVE POSITIONS ğŸ†•                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Position 1:                                                              â”‚
â”‚   â€¢ Symbol: BTC/USDT:USDT                                                â”‚
â”‚   â€¢ Side: LONG                                                           â”‚
â”‚   â€¢ Entry: $50,000.00                                                    â”‚
â”‚   â€¢ Current: $50,850.00                                                  â”‚
â”‚   â€¢ Amount: 0.02 BTC                                                     â”‚
â”‚   â€¢ Unrealized P&L: +$17.00 (+1.70%)                                     â”‚
â”‚   â€¢ Stop Loss: $49,000.00                                                â”‚
â”‚   â€¢ Take Profit: $55,000.00                                              â”‚
â”‚   â€¢ Trailing Stop: ACTIVE (highest: $50,900)                             â”‚
â”‚                                                                          â”‚
â”‚ Position 2:                                                              â”‚
â”‚   â€¢ Symbol: ETH/USDT:USDT                                                â”‚
â”‚   â€¢ Side: SHORT                                                          â”‚
â”‚   â€¢ Entry: $2,800.00                                                     â”‚
â”‚   â€¢ Current: $2,750.00                                                   â”‚
â”‚   â€¢ Amount: 1.5 ETH                                                      â”‚
â”‚   â€¢ Unrealized P&L: +$75.00 (+1.79%)                                     â”‚
â”‚   â€¢ Stop Loss: $2,900.00                                                 â”‚
â”‚   â€¢ Take Profit: $2,500.00                                               â”‚
â”‚   â€¢ Trailing Stop: ACTIVE (lowest: $2,740)                               â”‚
â”‚                                                                          â”‚
â”‚ Position 3:                                                              â”‚
â”‚   â€¢ Symbol: SOL/USDT:USDT                                                â”‚
â”‚   â€¢ Side: LONG                                                           â”‚
â”‚   â€¢ Entry: $145.00                                                       â”‚
â”‚   â€¢ Current: $147.50                                                     â”‚
â”‚   â€¢ Amount: 10 SOL                                                       â”‚
â”‚   â€¢ Unrealized P&L: +$25.00 (+1.72%)                                     â”‚
â”‚   â€¢ Stop Loss: $142.00                                                   â”‚
â”‚   â€¢ Take Profit: $155.00                                                 â”‚
â”‚   â€¢ Trailing Stop: INACTIVE                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RECENT SIGNALS (Duplicate Prevention) ğŸ†•                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚ Last 5 minutes:                                                          â”‚
â”‚   â€¢ BTC/USDT:USDT LONG @ $50,000 (2m ago) âœ… EXECUTED                    â”‚
â”‚   â€¢ ETH/USDT:USDT SHORT @ $2,800 (4m ago) âœ… EXECUTED                    â”‚
â”‚   â€¢ BTC/USDT:USDT LONG @ $50,020 (1m ago) âŒ DUPLICATE (ignored)        â”‚
â”‚   â€¢ SOL/USDT:USDT LONG @ $145 (3m ago) âœ… EXECUTED                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **KEY FEATURES SUMMARY**

### **âœ… Implemented Features**

**1. WebSocket Integration (PR #125) ğŸ†•**
- Priority data fetching (WebSocket â†’ REST fallback)
- Health monitoring (status, uptime, messages)
- Data freshness validation (<60s)
- Quality scoring (0-100)
- Performance metrics (latency, success rate)

**2. Position Monitoring (PR #123, #124) ğŸ†•**
- Real-time P&L tracking
- Stop loss detection
- Take profit detection
- Trailing stop support
- Enhanced logging with emojis
- Summary statistics

**3. Duplicate Prevention (PR #122) ğŸ†•**
- Signal deduplication (5-minute window)
- Entry price tolerance (Â±0.1%)
- Same symbol/side/timeframe check
- Recent signals cache

**4. Portfolio Capital Limit (PR #120) ğŸ†•**
- 80% max capital utilization
- Dynamic capital tracking
- Position sizing limits
- Capital availability check

**5. Professional Logging (PR #121) ğŸ†•**
- Startup banner with headers
- Emoji-based indicators
- Multi-line formatted output
- Structured log messages

**6. Core Trading Logic**
- Signal generation (EMA, volume, patterns)
- Risk management (1% per trade)
- Position sizing
- Trade execution (paper/live)

---

## ğŸ“ **LOG OUTPUT EXAMPLES**

### **Startup Logs:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    BEARISH ALPHA TRADING BOT v1.0                          
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ• Start Time: 2025-10-20 11:32:27 UTC
ğŸ‘¤ User: SefaGH
ğŸ”§ Mode: PAPER TRADING
ğŸ“Š Exchange: Bybit (Testnet)
ğŸ’° Initial Balance: $10,000.00
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[11:32:27] âœ… Exchange connection established
[11:32:27] âœ… Portfolio manager initialized
[11:32:27] âœ… Risk manager initialized (1% risk per trade)
[11:32:27] âœ… Signal generator initialized
[11:32:27] âœ… Position manager initialized
[11:32:28] ğŸ”Œ Starting WebSocket streams...
[11:32:28]    â””â”€ BTC/USDT:USDT (1m, 5m, 15m)
[11:32:28]    â””â”€ ETH/USDT:USDT (1m, 5m, 15m)
[11:32:29] âœ… WebSocket streams active (6 streams)
[11:32:29] ğŸ¯ Starting position monitoring loop (interval: 10s)
[11:32:29] ğŸš€ Starting strategy execution loop (interval: 5s)
[11:32:29] âœ… TRADING BOT RUNNING
```

### **Strategy Execution Logs:**

```
[11:32:34] ğŸ“¡ [WS-DATA] BTC/USDT:USDT 1m - 100 candles, 14.2ms
[11:32:34] ğŸ“ˆ [SIGNAL-GENERATED] BTC/USDT:USDT
           Action: LONG
           Entry: $50,000.00
           Stop Loss: $49,000.00 (-2.0%)
           Take Profit: $55
